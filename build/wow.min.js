app.controller("contactController",function(t,r,e){t.contact={},t.getContact=function(){e.getContact().then(function(r){t.contact={name:r.data.name,address:{street:r.data.address.street,city:r.data.address.city},phone:r.data.phone,hours:r.data.hours}})}}),app.controller("finalizeOrderController",function(t,r,e,o){t.order=r.order,t.basket=r.basket,t.total=r.total,t.form={phone:null,street:null,remarks:null},t.validOrder=!1,t.postFailed=!1,t.phoneValidation=function(){var r=t.form.phone,e=/[0-9]{9}/;e.test(r)?t.validOrder=!0:t.validOrder=!1},t.goToMain=function(){e.go("main")},t.postOrder=function(){o.postOrder(t.order).then(function(r){500===status?t.postFailed=!0:e.go("status",{id:r.data.id})})}}),app.controller("mainController",function(t,r,e,o){t.menu=[],t.order=[],t.basket=[],t.total=0,t.getMenu=function(){o.getMenu().then(function(r){t.menu=r.data})},t.addPositionToOrder=function(r,e,o,n){var a=!0;if(o>0){if(t.basket.forEach(function(t){t.name===e&&(t.count=t.count+o,a=!1)}),t.order.forEach(function(t){t.name===e&&(t.quantity=t.quantity+o,a=!1)}),a){var i={id:r,name:e,count:o,price:n.toFixed(2)},l={id:r,quantity:o};t.basket.push(i),t.order.push(l)}t.sumTotal()}},t.removePositionFromOrder=function(r){var e=t.basket.indexOf(r);t.basket.splice(e,1),t.order.splice(e,1),t.sumTotal()},t.sumTotal=function(){t.total=0,t.basket.forEach(function(r){t.total=t.total+r.count*r.price}),t.total=t.total.toFixed(2)},t.goToFinalizeOrder=function(){e.go("order",{order:t.order,basket:t.basket,total:t.total})},t.instantOrder=function(){t.order=[],t.basket=[],t.addPositionToOrder(this.position.id,this.position.name,1,this.position.price),t.goToFinalizeOrder()},t.getMenu()}),app.controller("orderStatusController",function(t,r,e,o){t.order={},t.id=e.id,t.getOrder=function(r){o.getOrder(r).then(function(r){t.order={id:r.data.id,estimated:r.data.estimated.substring(11,16)}})},t.getOrder(t.id)});var app=angular.module("PizzeriaApp",["ui.router"]).config(function(t,r){r.otherwise("/"),t.state("main",{url:"/",templateUrl:"public/main.html",controller:"mainController"}).state("contact",{url:"/contact",templateUrl:"public/contact.html",controller:"contactController"}).state("order",{url:"/order",templateUrl:"public/finalizeOrder.html",controller:"finalizeOrderController",params:{order:null,basket:null,total:0}}).state("status",{url:"/order/:id",templateUrl:"public/orderStatus.html",controller:"orderStatusController",params:{id:null}})});app.service("dataFromServer",function(t){return{getContact:function(){return t.get("/contact").then(function(t){return t})},getMenu:function(){return t.get("/menu").then(function(t){return t})},postOrder:function(r){return t.post("/order",r).then(function(t){return t})},getOrder:function(r){return t.get("/order/"+r).then(function(t){return t})}}});